<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Game</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css');

        body {
            font-family: 'pretendard', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            width: 90vw;
            margin: 0 auto;
            padding: 2vw 0;
        }

        .gameSection {
            width: 90%;
            min-height: 45vw;
            border-radius: 1.5vw;
            margin: 7vw auto;
            display: flex;
            justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .hidden {
            display: none !important;
        }

        .stage {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            text-align: center;
            flex-direction: column;
            width: 100%;
            padding: 2vw;
            position: relative;
            z-index: 2;
            min-height: 41vw;
        }

        .stage.intro-stage {
            align-items: center;
            justify-content: center;
        }

        /* ë°°ê²½ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .movie01 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1.5vw;
            filter: grayscale(100%) brightness(0.7);
            z-index: 1;
        }

        .stage::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 1.5vw;
            z-index: 1;
        }

        .stage > * {
            position: relative;
            z-index: 3;
        }

        .stage-title img {
            width: 17vw;
            margin-bottom: 1vw;
        }

        .stage-description {
            font-size: 1.2vw;
            margin-bottom: 2vw;
            line-height: 1.6vw;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            max-width: 60vw;
        }

        /* ì¹´ë“œ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .cards-container {
            display: flex;
            gap: 2vw;
            justify-content: center;
            margin: 2vw 0;
            transition: all 0.8s ease;
            width: 100%;
        }

        .cards-container.selected-state {
            justify-content: flex-start;
            align-items: flex-start;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            width: 8vw;
            height: 12vw;
            perspective: 1000px;
            cursor: pointer;
            transition: all 0.8s ease;
        }

        .card.selected {
            margin-right: 2vw;
        }

        .card.hidden {
            opacity: 0;
            transform: scale(0) translateY(-50px);
            pointer-events: none;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 0.8vw;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card-front {
            transform: rotateY(180deg);
        }

        .card-back {
            transform: rotateY(0deg);
        }

        /* ê²Œì„ ì½˜í…ì¸  ë ˆì´ì•„ì›ƒ */
        .game-content {
            display: flex;
            align-items: flex-start;
            gap: 2vw;
            width: 100%;
            margin-top: 1vw;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.8s ease;
        }

        .game-content.show {
            opacity: 1;
            transform: translateX(0);
        }

        .story-and-actions {
            flex: 1;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 1.5vw;
        }

        .story-text {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5vw;
            border-radius: 1vw;
            font-size: 1vw;
            line-height: 1.6vw;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .action-choices {
            display: flex;
            flex-direction: column;
            gap: 0.8vw;
        }

        .action-choice {
            background: rgba(255, 255, 255, 0.9);
            padding: 1vw 1.5vw;
            border-radius: 0.8vw;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 1vw;
            line-height: 1.4vw;
        }

        .action-choice:hover {
            background: rgba(171, 255, 0, 0.8);
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(0, 0, 0, 0.1);
        }

        .action-choice.selected {
            background: rgba(171, 255, 0, 0.9);
            border-color: #333;
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            background: linear-gradient(180deg, #E5FFB0, #ABFF00);
            color: #212121;
            border: 0.1vw solid #000;
            padding: 0.8vw 2vw;
            font-size: 1.2vw;
            font-weight: 600;
            border-radius: 3vw;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1vw;
        }

        button:hover {
            transform: translateY(-0.2vw);
            box-shadow: 0 0.4vw 0.8vw rgba(0, 0, 0, 0.25);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .buttons {
            margin-top: 2vw;
        }

        /* ì—”ë”© ì„¹ì…˜ */
        .ending-section {
            text-align: center;
            padding: 3vw;
        }

        .ending-text {
            background: rgba(255, 255, 255, 0.9);
            padding: 2vw;
            border-radius: 1vw;
            font-size: 1.1vw;
            line-height: 1.6vw;
            white-space: pre-line;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        /* ì‹œì‘ í™”ë©´ */
        .stage-start img {
            width: 40vw;
            margin-bottom: 2vw;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="gameSection">
            <!-- ì‹œì‘ í™”ë©´ -->
            <div id="intro" class="stage intro-stage">
                <div class="stage-start">
                    <h1 style="color: white; font-size: 3vw; margin-bottom: 2vw;">íƒ€ë¡œ ìš´ëª… ê²Œì„</h1>
                </div>
                <button id="start-button">ê²Œì„ ì‹œì‘</button>
            </div>

            <!-- ê²Œì„ ìŠ¤í…Œì´ì§€ -->
            <div id="game-stage" class="stage hidden">
                <img class="movie01" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232c3e50'/%3E%3Cstop offset='100%25' style='stop-color:%23bdc3c7'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='600' fill='url(%23grad)'/%3E%3Ctext x='400' y='300' text-anchor='middle' fill='white' font-size='24' font-family='Arial'%3Eíƒ€ì´íƒ€ë‹‰ ë°°ê²½ ì´ë¯¸ì§€%3C/text%3E%3C/svg%3E">
                
                <div class="stage-title" id="stage-title">
                    <h2 style="color: white; font-size: 2vw; margin-bottom: 1vw;">ì œ1ì¥: ì‹œì‘ì˜ ë¬¸</h2>
                </div>

                <div class="stage-description" id="stage-description">
                    íƒ€ì´íƒ€ë‹‰ í˜¸ì˜ ì¹¨ëª° ì˜ˆì–¸ í›„ í•­êµ¬ë¡œ ë›°ì–´ê°„ ë‹¹ì‹ !<br>
                    ë‹¹ì‹ ì€ ì¶œí•­ ì§ì „ì˜ ë°°ë¥¼ ë°œê²¬í•œ í›„ ì„ ì¥ì„ ì°¾ì•„ ë‹¬ë ¤ê°‘ë‹ˆë‹¤.<br>
                    ì„ ì¥ì—ê²Œ ì–´ë–¤ ë§ì„ í• ê¹Œìš”?
                </div>

                <div class="cards-container" id="cards-container">
                    <!-- ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="game-content" id="game-content">
                    <div class="story-and-actions">
                        <div class="story-text hidden" id="story-text"></div>
                        <div class="action-choices hidden" id="action-choices">
                            <!-- í–‰ë™ ì„ íƒì§€ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button id="next-button" disabled>ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
                </div>
            </div>

            <!-- ì—”ë”© í™”ë©´ -->
            <div id="ending" class="stage hidden">
                <div class="ending-section">
                    <h2 style="color: white; margin-bottom: 2vw;">ê²Œì„ ì™„ë£Œ!</h2>
                    <div class="ending-text" id="ending-text">
                        ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì‹ ì€ íƒ€ì´íƒ€ë‹‰ì˜ ìš´ëª…ì„ ë°”ê¿¨ìŠµë‹ˆë‹¤.
                        ë‹¹ì‹ ì˜ ì„ íƒë“¤ì´ ìƒˆë¡œìš´ ë¯¸ë˜ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                    <button id="restart-button">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // íƒ€ë¡œì¹´ë“œ ë°ì´í„°
        const tarotCards = [
            { 
                id: 0, 
                name: "ë°”ë³´", 
                symbol: "ğŸƒ",
                frontImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Crect width='150' height='200' fill='%23ff6b6b'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='40'%3EğŸƒ%3C/text%3E%3Ctext x='75' y='150' text-anchor='middle' fill='white' font-size='14'%3Eë°”ë³´%3C/text%3E%3C/svg%3E",
                backImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Cdefs%3E%3ClinearGradient id='back' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234facfe'/%3E%3Cstop offset='100%25' style='stop-color:%2300f2fe'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='150' height='200' fill='url(%23back)'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='30'%3EğŸ”®%3C/text%3E%3Ctext x='75' y='130' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3ETAROT%3C/text%3E%3C/svg%3E"
            },
            { 
                id: 1, 
                name: "ë§ˆë²•ì‚¬", 
                symbol: "âœ¨",
                frontImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Crect width='150' height='200' fill='%23845ec2'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='40'%3Eâœ¨%3C/text%3E%3Ctext x='75' y='150' text-anchor='middle' fill='white' font-size='14'%3Eë§ˆë²•ì‚¬%3C/text%3E%3C/svg%3E",
                backImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Cdefs%3E%3ClinearGradient id='back' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234facfe'/%3E%3Cstop offset='100%25' style='stop-color:%2300f2fe'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='150' height='200' fill='url(%23back)'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='30'%3EğŸ”®%3C/text%3E%3Ctext x='75' y='130' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3ETAROT%3C/text%3E%3C/svg%3E"
            },
            { 
                id: 2, 
                name: "ì—¬ì‚¬ì œ", 
                symbol: "ğŸŒ™",
                frontImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Crect width='150' height='200' fill='%23b39bc8'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='40'%3EğŸŒ™%3C/text%3E%3Ctext x='75' y='150' text-anchor='middle' fill='white' font-size='14'%3Eì—¬ì‚¬ì œ%3C/text%3E%3C/svg%3E",
                backImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Cdefs%3E%3ClinearGradient id='back' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234facfe'/%3E%3Cstop offset='100%25' style='stop-color:%2300f2fe'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='150' height='200' fill='url(%23back)'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='30'%3EğŸ”®%3C/text%3E%3Ctext x='75' y='130' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3ETAROT%3C/text%3E%3C/svg%3E"
            },
            { 
                id: 18, 
                name: "ë‹¬", 
                symbol: "ğŸŒ•",
                frontImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Crect width='150' height='200' fill='%23f093fb'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='40'%3EğŸŒ•%3C/text%3E%3Ctext x='75' y='150' text-anchor='middle' fill='white' font-size='14'%3Eë‹¬%3C/text%3E%3C/svg%3E",
                backImage: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 200'%3E%3Cdefs%3E%3ClinearGradient id='back' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234facfe'/%3E%3Cstop offset='100%25' style='stop-color:%2300f2fe'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='150' height='200' fill='url(%23back)'/%3E%3Ctext x='75' y='100' text-anchor='middle' fill='white' font-size='30'%3EğŸ”®%3C/text%3E%3Ctext x='75' y='130' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3ETAROT%3C/text%3E%3C/svg%3E"
            }
        ];

        // ìŠ¤í…Œì´ì§€ ë°ì´í„°
        const stages = [
            {
                title: "ì œ1ì¥: ì‹œì‘ì˜ ë¬¸",
                description: "íƒ€ì´íƒ€ë‹‰ í˜¸ì˜ ì¹¨ëª° ì˜ˆì–¸ í›„ í•­êµ¬ë¡œ ë›°ì–´ê°„ ë‹¹ì‹ !<br>ë‹¹ì‹ ì€ ì¶œí•­ ì§ì „ì˜ ë°°ë¥¼ ë°œê²¬í•œ í›„ ì„ ì¥ì„ ì°¾ì•„ ë‹¬ë ¤ê°‘ë‹ˆë‹¤.<br>ì„ ì¥ì—ê²Œ ì–´ë–¤ ë§ì„ í• ê¹Œìš”?",
                cards: [0, 1, 2, 18],
                stories: {
                    0: "ë‹¹ì‹ ì€ ì ˆë²½ ì•ì— ì„œ ìˆìŠµë‹ˆë‹¤. ë§ì„¤ì„ ì—†ì´ ë›°ì–´ë‚´ë¦¬ì ì‹ ë¹„í•œ ë°”ëŒì´ ë‹¹ì‹ ì„ ê°ì‹¸ ì•ˆì•˜ìŠµë‹ˆë‹¤. ë¬´ëª¨í•´ ë³´ì´ëŠ” ì„ íƒì´ ë•Œë¡œëŠ” ê°€ì¥ í° ê°€ëŠ¥ì„±ì„ ì—´ì–´ì¤ë‹ˆë‹¤.",
                    1: "ëˆˆì•ì— ì‹ ë¹„í•œ ë¬¸ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ë¬¸ì„ ì—´ì ë¹›ì˜ ì„¸ê³„ê°€ í¼ì³ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì€ ìì‹ ì˜ í˜ìœ¼ë¡œ ìš´ëª…ì„ ì°½ì¡°í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.",
                    2: "ê³ ìš”í•œ ìˆ²ì†, ë‹¬ë¹› ì•„ë˜ ë‹¹ì‹ ì€ ë¹„ë°€ì˜ ì±…ì„ ë°œê²¬í•©ë‹ˆë‹¤. ê·¸ ì•ˆì—ëŠ” ë‹¹ì‹ ë§Œì´ ì½ì„ ìˆ˜ ìˆëŠ” ì§€í˜œê°€ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤. ì§ê´€ì„ ë”°ë¥´ëŠ” ì—¬ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤.",
                    18: "ë‹¬ë¹›ì´ ë°”ë‹¤ë¥¼ ë¹„ì¶”ê³  ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì‹ ë¹„ë¡œìš´ í™˜ìƒ ì†ì—ì„œ ì§„ì‹¤ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ì§ê´€ê³¼ ê¿ˆì˜ ì„¸ê³„ê°€ ë‹¹ì‹ ì„ ì•ˆë‚´í•  ê²ƒì…ë‹ˆë‹¤."
                },
                actions: {
                    0: [
                        { text: "ì ˆë²½ì—ì„œ ë›°ì–´ë‚´ë¦°ë‹¤" },
                        { text: "ë‹¤ë¥¸ ê¸¸ì„ ì°¾ì•„ë³¸ë‹¤" },
                        { text: "ì ˆë²½ ìœ„ì—ì„œ ëª…ìƒí•œë‹¤" }
                    ],
                    1: [
                        { text: "ë¬¸ì„ ì—´ê³  ë“¤ì–´ê°„ë‹¤" },
                        { text: "ë¬¸ì˜ í‹ˆìƒˆë¡œ ë¨¼ì € ì‚´í´ë³¸ë‹¤" },
                        { text: "ë¬¸ì— ìƒˆê²¨ì§„ ë¬¸ì–‘ì„ ì—°êµ¬í•œë‹¤" }
                    ],
                    2: [
                        { text: "ì±…ì„ í¼ì³ ì½ëŠ”ë‹¤" },
                        { text: "ì±…ì„ ë‹¬ë¹›ì— ë¹„ì¶°ë³¸ë‹¤" },
                        { text: "ì±…ì„ ì†Œì¤‘íˆ ê°„ì§í•œë‹¤" }
                    ],
                    18: [
                        { text: "ë‹¬ë¹›ì˜ ì•ˆë‚´ë¥¼ ë”°ë¥¸ë‹¤" },
                        { text: "í™˜ìƒì„ ë¬´ì‹œí•˜ê³  í˜„ì‹¤ì— ì§‘ì¤‘í•œë‹¤" },
                        { text: "ê¿ˆê³¼ í˜„ì‹¤ì˜ ê²½ê³„ë¥¼ íƒí—˜í•œë‹¤" }
                    ]
                }
            }
        ];

        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentStage: 0,
            selectedCards: [],
            selectedActions: []
        };

        // DOM ìš”ì†Œ
        const introSection = document.getElementById('intro');
        const gameStageSection = document.getElementById('game-stage');
        const endingSection = document.getElementById('ending');
        const stageTitle = document.getElementById('stage-title');
        const stageDescription = document.getElementById('stage-description');
        const cardsContainer = document.getElementById('cards-container');
        const gameContent = document.getElementById('game-content');
        const storyText = document.getElementById('story-text');
        const actionChoices = document.getElementById('action-choices');
        const nextButton = document.getElementById('next-button');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const endingText = document.getElementById('ending-text');

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        startButton.addEventListener('click', startGame);
        nextButton.addEventListener('click', goToNextStage);
        restartButton.addEventListener('click', restartGame);

        function startGame() {
            gameState = {
                currentStage: 0,
                selectedCards: [],
                selectedActions: []
            };
            
            introSection.classList.add('hidden');
            gameStageSection.classList.remove('hidden');
            endingSection.classList.add('hidden');
            
            loadStage(gameState.currentStage);
        }

        function loadStage(stageIndex) {
            const stage = stages[stageIndex];
            
            // ìŠ¤í…Œì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
            stageTitle.innerHTML = `<h2 style="color: white; font-size: 2vw;">${stage.title}</h2>`;
            stageDescription.innerHTML = stage.description;
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            storyText.classList.add('hidden');
            actionChoices.classList.add('hidden');
            gameContent.classList.remove('show');
            cardsContainer.classList.remove('selected-state');
            nextButton.disabled = true;
            
            // ì¹´ë“œ ìƒì„±
            createCards(stage.cards);
        }

        function createCards(cardIds) {
            cardsContainer.innerHTML = '';
            
            cardIds.forEach(cardId => {
                const card = tarotCards.find(c => c.id === cardId);
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.cardId = card.id;
                
                cardElement.innerHTML = `
                    <div class="card-inner">
                        <div class="card-back" style="background-image: url('${card.backImage}')"></div>
                        <div class="card-front" style="background-image: url('${card.frontImage}')"></div>
                    </div>
                `;
                
                cardElement.addEventListener('click', () => selectCard(cardElement, card.id));
                cardsContainer.appendChild(cardElement);
            });
        }

        function selectCard(cardElement, cardId) {
            // ì´ë¯¸ ì„ íƒëœ ì¹´ë“œê°€ ìˆìœ¼ë©´ ë¬´ì‹œ
            if (cardsContainer.querySelector('.card.selected')) {
                return;
            }
            
            // ì¹´ë“œ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜
            cardElement.classList.add('flipped');
            cardElement.classList.add('selected');
            
            // ë‹¤ë¥¸ ì¹´ë“œë“¤ ì™„ì „íˆ ìˆ¨ê¸°ê¸°
            const allCards = cardsContainer.querySelectorAll('.card');
            allCards.forEach(card => {
                if (card !== cardElement) {
                    setTimeout(() => {
                        card.classList.add('hidden');
                    }, 200); // ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜ í›„ ìˆ¨ê¹€
                }
            });
            
            // ë ˆì´ì•„ì›ƒ ë³€ê²½
            setTimeout(() => {
                cardsContainer.classList.add('selected-state');
                showStoryAndActions(cardId);
            }, 600);
            
            // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
            gameState.selectedCards[gameState.currentStage] = cardId;
        }

        function showStoryAndActions(cardId) {
            const stage = stages[gameState.currentStage];
            
            // ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸ í‘œì‹œ
            storyText.textContent = stage.stories[cardId];
            storyText.classList.remove('hidden');
            
            // í–‰ë™ ì„ íƒì§€ ìƒì„±
            actionChoices.innerHTML = '';
            const actions = stage.actions[cardId];
            
            actions.forEach((action, index) => {
                const actionElement = document.createElement('div');
                actionElement.className = 'action-choice';
                actionElement.textContent = action.text;
                
                actionElement.addEventListener('click', () => selectAction(actionElement, cardId, index));
                actionChoices.appendChild(actionElement);
            });
            
            actionChoices.classList.remove('hidden');
            gameContent.classList.add('show');
        }

        function selectAction(actionElement, cardId, actionIndex) {
            // ì´ë¯¸ ì„ íƒëœ í–‰ë™ì´ ìˆìœ¼ë©´ ì„ íƒ í•´ì œ
            const selectedAction = actionChoices.querySelector('.action-choice.selected');
            if (selectedAction) {
                selectedAction.classList.remove('selected');
            }
            
            // ìƒˆ í–‰ë™ ì„ íƒ
            actionElement.classList.add('selected');
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            nextButton.disabled = false;
            
            // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
            gameState.selectedActions[gameState.currentStage] = actionIndex;
        }

        function goToNextStage() {
            gameState.currentStage++;
            
            if (gameState.currentStage < stages.length) {
                loadStage(gameState.currentStage);
            } else {
                showEnding();
            }
        }

        function showEnding() {
            gameStageSection.classList.add('hidden');
            endingSection.classList.remove('hidden');
            
            // ê°„ë‹¨í•œ ì—”ë”© ë©”ì‹œì§€
            endingText.textContent = `ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¹ì‹ ì€ íƒ€ì´íƒ€ë‹‰ì˜ ìš´ëª…ì„ ë°”ê¿¨ìŠµë‹ˆë‹¤.\në‹¹ì‹ ì˜ í˜„ëª…í•œ ì„ íƒë“¤ì´ ìƒˆë¡œìš´ ë¯¸ë˜ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤.\n\nì„ íƒí•œ ì¹´ë“œë“¤: ${gameState.selectedCards.map(id => tarotCards.find(c => c.id === id)?.name).join(', ')}`;
        }

        function restartGame() {
            endingSection.classList.add('hidden');
            introSection.classList.remove('hidden');
        }
    </script>
</body>
</html>