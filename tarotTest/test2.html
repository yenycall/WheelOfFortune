<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>타로 스토리 게임</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #0f0f2a;
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #f8d348;
            margin-bottom: 30px;
        }
        
        .stage {
            margin-bottom: 30px;
        }
        
        .stage-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #f8d348;
        }
        
        .stage-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .cards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }
        
        .card {
            width: 150px;
            height: 250px;
            background-color: #272755;
            border: 2px solid #f8d348;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(248, 211, 72, 0.3);
        }
        
        .card.selected {
            border-color: #ff6b6b;
            box-shadow: 0 0 20px #ff6b6b;
        }
        
        .card-front {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backface-visibility: hidden;
        }
        
        .card-name {
            font-weight: bold;
            margin-top: 10px;
        }
        
        .card-image {
            width: 100px;
            height: 150px;
            background-color: #121236;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        
        .buttons {
            margin-top: 30px;
        }
        
        button {
            background-color: #f8d348;
            color: #0f0f2a;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #ff6b6b;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .story-text {
            background-color: #272755;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.8;
            text-align: left;
        }
        
        .ending {
            margin-top: 30px;
            padding: 20px;
            background-color: #272755;
            border-radius: 10px;
            border: 2px solid #f8d348;
        }
        
        .ending h2 {
            color: #f8d348;
        }
        
        .hidden {
            display: none;
        }
        
        /* 새로 추가된 스타일 - 행동 선택지 */
        .action-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        
        .action-choice {
            background-color: #272755;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #f8d348;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            text-align: left;
        }
        
        .action-choice:hover {
            background-color: #363677;
            transform: translateX(5px);
        }
        
        .action-choice.selected {
            background-color: #3d3d8a;
            border-color: #ff6b6b;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        
        .action-result {
            background-color: #1e1e4a;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: left;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>운명의 타로 여정</h1>
        
        <div id="intro" class="stage">
            <div class="stage-description">
                타로 점술가인 당신은 타로카드를 통해 "타이타닉 호"의 침몰을 예언하게 됩니다. <br>
                타이타닉호의 침몰을 막기 위해 당신은 어떻게 행동할 것인가요? <br>
                타로카드를 뽑아 나온 선택지를 통해 미래를 바꾸어보자! <br>
                *위 게임은 타이타닉 영화를 바탕으로 제작되었습니다. <br>
            </div>
            <button id="start-button">여정 시작하기</button>
        </div>
        
        <div id="game-stage" class="stage hidden">
            <div class="stage-title" id="stage-title">제1장: 시작의 문</div>
            <div class="stage-description" id="stage-description">
                당신의 여정이 시작됩니다. 어떤 카드가 당신을 부르는지 직감으로 선택하세요.
            </div>
            
            <div class="cards-container" id="cards-container">
                <!-- 카드는 JS로 동적 생성됩니다 -->
            </div>
            
            <div class="story-text hidden" id="story-text"></div>
            
            <!-- 행동 선택지 컨테이너 (새로 추가) -->
            <div class="action-choices hidden" id="action-choices">
                <!-- 행동 선택지는 JS로 동적 생성됩니다 -->
            </div>
            
            <!-- 행동 결과 컨테이너 (새로 추가) -->
            <!-- <div class="action-result hidden" id="action-result"></div> -->
            
            <div class="buttons">
                <button id="next-button" disabled>다음 단계로</button>
            </div>
        </div>
        
        <div id="ending" class="stage hidden">
            <h2>당신의 운명</h2>
            <div id="ending-text" class="story-text"></div>
            <button id="restart-button">다시 시작하기</button>
        </div>
    </div>

    <script>
        // 타로 카드 정의
        const tarotCards = [
            { id: 0, name: "바보", symbol: "🃏" },
            { id: 1, name: "마법사", symbol: "✨" },
            { id: 2, name: "여사제", symbol: "🌙" },
            { id: 3, name: "여황제", symbol: "👑" },
            { id: 4, name: "황제", symbol: "⚔️" },
            { id: 5, name: "교황", symbol: "📜" },
            { id: 6, name: "연인들", symbol: "❤️" },
            { id: 7, name: "전차", symbol: "🏆" },
            { id: 8, name: "힘", symbol: "💪" },
            { id: 9, name: "은둔자", symbol: "🔦" },
            { id: 10, name: "운명의 수레바퀴", symbol: "🎡" },
            { id: 11, name: "정의", symbol: "⚖️" },
            { id: 12, name: "매달린 사람", symbol: "🙃" },
            { id: 13, name: "죽음", symbol: "💀" },
            { id: 14, name: "절제", symbol: "🍵" },
            { id: 15, name: "악마", symbol: "😈" },
            { id: 16, name: "탑", symbol: "🗼" },
            { id: 17, name: "별", symbol: "⭐" },
            { id: 18, name: "달", symbol: "🌕" },
            { id: 19, name: "태양", symbol: "☀️" },
            { id: 20, name: "심판", symbol: "📯" },
            { id: 21, name: "세계", symbol: "🌍" }
        ];
        
        // 스테이지 정의 (행동 선택지 추가)
        const stages = [
            {
                title: "제1장: 시작의 문",
                description: "당신의 여정이 시작됩니다. 어떤 카드가 당신을 부르는지 직감으로 선택하세요.",
                cards: [0, 1, 2, 3],
                stories: {
                    0: "당신은 절벽 앞에 서 있습니다. 망설임 없이 뛰어내리자 신비한 바람이 당신을 감싸 안았습니다. 무모해 보이는 선택이 때로는 가장 큰 가능성을 열어줍니다.",
                    1: "눈앞에 신비한 문이 나타납니다. 문을 열자 빛의 세계가 펼쳐집니다. 당신은 자신의 힘으로 운명을 창조할 수 있는 능력을 가지고 있습니다.",
                    2: "고요한 숲속, 달빛 아래 당신은 비밀의 책을 발견합니다. 그 안에는 당신만이 읽을 수 있는 지혜가 담겨 있습니다. 직관을 따르는 여정이 시작됩니다.",
                    3: "화려한 정원에서 당신은 왕관을 쓴 여인을 만납니다. 그녀는 당신에게 풍요와 창조의 힘을 선물합니다. 당신 안에 내재된 풍요로움을 발견하는 여정입니다."
                },
                // 각 카드에 대한 행동 선택지 추가
                actions: {
                    0: [
                        { 
                            text: "절벽에서 뛰어내린다",
                        },
                        { 
                            text: "다른 길을 찾아본다",
                        },
                        { 
                            text: "절벽 위에서 명상한다",
                        }
                    ],
                    1: [
                        { 
                            text: "문을 열고 들어간다",
                        },
                        { 
                            text: "문의 틈새로 먼저 살펴본다",
                        },
                        { 
                            text: "문에 새겨진 문양을 연구한다",
                        }
                    ],
                    2: [
                        { 
                            text: "책을 펼쳐 읽는다",
                        },
                        { 
                            text: "책을 달빛에 비춰본다",
                        },
                        { 
                            text: "책을 소중히 간직한다",
                        }
                    ],
                    3: [
                        { 
                            text: "여인에게 경의를 표한다",
                            result: "여인은 미소로 답하며 당신의 이마에 손을 댑니다. 축복의 기운이 당신을 감싸안습니다."
                        },
                        { 
                            text: "여인에게 질문을 던진다",
                            result: "여인은 수수께끼 같은 답변을 주지만, 그 속에 깊은 지혜가 담겨있습니다. 질문하는 자세가 성장의 열쇠입니다."
                        },
                        { 
                            text: "정원을 탐험한다",
                            result: "정원 속에서 놀라운 생명력을 목격합니다. 당신도 그 일부가 되어 자연과 하나됨을 느낍니다."
                        }
                    ]
                }
            },
            {
                title: "제2장: 선택의 갈림길",
                description: "첫 번째 시험을 통과했습니다. 이제 당신 앞에 갈림길이 나타납니다. 어떤 길을 선택하시겠습니까?",
                cards: [6, 7, 8, 9],
                stories: {
                    6: "두 사람이 당신 앞에 나타납니다. 하나를 선택해야 하지만, 그것은 단순한 사랑이 아닌 가치관의 선택입니다. 당신은 마음의 소리를 따릅니다.",
                    7: "빠른 속도로 달리는 전차가 당신을 맞이합니다. 올라타자 당신은 모든 장애물을 뚫고 앞으로 나아갑니다. 당신의 의지가 운명을 결정합니다.",
                    8: "거대한 사자가 길을 막고 있습니다. 두려움 대신 당신은 부드럽게 다가가 사자를 길들입니다. 진정한 힘은 통제가 아닌 조화에서 옵니다.",
                    9: "어두운 동굴이 나타납니다. 작은 등불 하나만 들고 들어가는 용기를 내자, 내면의 지혜가 당신을 인도합니다. 고독한 성찰의 시간이 필요합니다."
                },
                actions: {
                    6: [
                        { 
                            text: "첫 번째 사람을 선택한다",
                            result: "이 선택은 안정과 조화의 길로 이어집니다. 때로는 익숙함이 가장 큰 위안이 됩니다."
                        },
                        { 
                            text: "두 번째 사람을 선택한다",
                            result: "이 선택은 모험과 발견의 길로 이어집니다. 새로운 가능성이 당신을 기다리고 있습니다."
                        },
                        { 
                            text: "자신의 길을 선택한다",
                            result: "독립적인 결정이 자아 발견으로 이어집니다. 당신은 자신만의 길을 개척하는 용기를 가졌습니다."
                        }
                    ],
                    7: [
                        { 
                            text: "전차를 직접 몰아본다",
                            result: "당신은 운명의 고삐를 잡고 방향을 정합니다. 주도적인 태도가 당신의 여정을 가속화합니다."
                        },
                        { 
                            text: "풍경을 감상하며 여행을 즐긴다",
                            result: "과정의 아름다움을 발견합니다. 당신은 여정 자체에서 의미를 찾는 지혜가 있습니다."
                        },
                        { 
                            text: "다른 승객들과 대화를 나눈다",
                            result: "다양한 이야기와 관점을 듣습니다. 소통을 통해 더 넓은 세계를 이해하게 됩니다."
                        }
                    ],
                    8: [
                        { 
                            text: "사자와 눈을 맞춘다",
                            result: "깊은 이해가 당신과 사자 사이에 형성됩니다. 두려움 없는 마주함이 존중으로 이어집니다."
                        },
                        { 
                            text: "사자에게 먹이를 제공한다",
                            result: "나눔의 행위가 신뢰를 쌓습니다. 당신은 관대함으로 어려움을 극복할 수 있습니다."
                        },
                        { 
                            text: "사자와 함께 길을 걷는다",
                            result: "당신은 위협을 동반자로 변화시킬 수 있는 능력이 있습니다. 조화로운 공존의 길을 발견합니다."
                        }
                    ],
                    9: [
                        { 
                            text: "등불을 높이 들고 동굴을 탐험한다",
                            result: "어둠 속에서도 길을 밝히는 용기가 있습니다. 당신은 미지의 영역을 탐험하는 선구자입니다."
                        },
                        { 
                            text: "벽에 그려진 그림을 살펴본다",
                            result: "고대의 지혜와 연결됩니다. 과거의 메시지에서 미래를 위한 통찰을 얻습니다."
                        },
                        { 
                            text: "동굴 깊숙한 곳에서 명상한다",
                            result: "깊은 고요 속에서 자아를 발견합니다. 내면의 소리에 귀 기울이는 것이 가장 큰 지혜입니다."
                        }
                    ]
                }
            },
            // 나머지 스테이지도 비슷한 방식으로 행동 선택지 추가 (간략화)
            {
                title: "제3장: 시련의 순간",
                description: "여정이 계속됩니다. 이제 당신은 피할 수 없는 시련과 마주합니다. 어떻게 대응하시겠습니까?",
                cards: [12, 13, 15, 16],
                stories: {
                    12: "당신은 갑자기 거꾸로 매달립니다. 세상이 뒤집혀 보이지만, 이 관점의 변화는 새로운 통찰력을 줍니다. 때로는 모든 것을 내려놓아야 합니다.",
                    13: "모든 것이 사라지는 순간을 경험합니다. 두려운 순간이지만, 이것은 끝이 아닌 변화의 시작입니다. 낡은 것이 가야 새것이 올 수 있습니다.",
                    15: "어둠 속에서 당신을 유혹하는 목소리가 들립니다. 쉬운 길을 제안하지만, 대가는 너무 큽니다. 당신의 내면의 욕망과 그림자를 직면하는 시간입니다.",
                    16: "갑작스러운 번개가 당신이 쌓아온 탑을 무너뜨립니다. 고통스럽지만, 이는 진정한 토대 위에 다시 세우라는 신호입니다. 파괴 후에 재건이 따릅니다."
                },
                actions: {
                    12: [
                        { text: "새로운 관점을 받아들인다", result: "전환된 시각이 문제의 해결책이 됩니다. 때로는 세상을 다르게 보는 것이 필요합니다." },
                        { text: "원래 자세로 돌아가려 노력한다", result: "익숙함을 추구하는 과정에서 자신의 한계를 발견합니다. 도전이 성장을 가져옵니다." },
                        { text: "거꾸로 된 상태에서 명상한다", result: "혼란 속에서 평화를 찾는 법을 배웁니다. 어떤 상황에서도 중심을 잡을 수 있습니다." }
                    ],
                    13: [
                        { text: "변화를 받아들인다", result: "죽음은 새로운 시작의 문입니다. 당신은 변화의 흐름에 순응하는 지혜를 얻었습니다." },
                        { text: "과거의 기억을 붙잡는다", result: "소중한 것을 간직하는 것도 때로는 필요합니다. 당신은 역사와 전통의 수호자입니다." },
                        { text: "재탄생의 의식을 진행한다", result: "자신을 새롭게 정의합니다. 당신은 자신을 끊임없이 재창조할 수 있는 능력이 있습니다." }
                    ],
                    15: [
                        { text: "유혹을 단호히 거부한다", result: "내면의 통제력을 발휘합니다. 당신은 자신의 원칙에 충실한 사람입니다." },
                        { text: "유혹의 원천과 대화한다", result: "자신의 그림자와 마주합니다. 자신의 어두운 면까지 이해하는 것이 완전한 자아 이해의 길입니다." },
                        { text: "유혹을 통찰의 기회로 삼는다", result: "모든 경험에서 배움을 찾습니다. 당신은 어둠조차 지혜로 변환시킬 수 있습니다." }
                    ],
                    16: [
                        { text: "무너진 탑의 잔해 속에서 가치 있는 것을 찾는다", result: "파괴 속에서도 의미를 발견합니다. 당신은 어떤 상황에서도 희망을 찾는 능력이 있습니다." },
                        { text: "새로운 탑을 설계한다", result: "더 견고한 기반 위에 재건합니다. 실패의 교훈을 미래의 성공으로 전환할 수 있습니다." },
                        { text: "탑 없이 살아가는 방법을 모색한다", result: "진정한 자유를 발견합니다. 때로는 구조에서 벗어나는 것이 가장 큰 해방입니다." }
                    ]
                }
            },
            {
                title: "제4장: 희망의 빛",
                description: "시련을 지나 희망의 빛이 보입니다. 당신의 여정에 어떤 빛이 함께할까요?",
                cards: [17, 18, 19, 20],
                stories: {
                    17: "어둠 속에서 빛나는 별들이 당신을 인도합니다. 희망과 영감이 당신 안에 새롭게 피어납니다. 당신은 자신만의 별자리를 만들어갑니다.",
                    18: "신비로운 달빛 아래, 숨겨진 진실이 드러납니다. 환상과 현실 사이에서 당신은 더 깊은 의식의 세계로 들어갑니다. 무의식의 지혜를 담아가세요.",
                    19: "따뜻한 태양빛이 당신을 감싸안습니다. 모든 불확실성이 사라지고 명확한 길이 보입니다. 성공과 성취의 순간이 찾아왔습니다.",
                    20: "거대한 나팔 소리와 함께 부활의 순간이 찾아옵니다. 과거의 모든 선택들이 심판대에 오르지만, 이는 새로운 시작을 위한 정화입니다."
                },
                actions: {
                    17: [
                        { text: "별빛 아래서 소원을 빈다", result: "우주의 기운이 당신의 의도에 응답합니다. 희망은 현실화의 첫 단계입니다." },
                        { text: "별자리를 공부한다", result: "패턴과 연결성을 이해합니다. 당신은 큰 그림을 볼 수 있는 통찰력이 있습니다." },
                        { text: "자신만의 별을 창조한다", result: "내면의 빛을 발산합니다. 당신은 다른 이들에게 영감을 주는 존재가 될 것입니다." }
                    ],
                    18: [
                        { text: "달빛 아래서 춤을 춘다", result: "직관적인 움직임이 내면의 지혜를 깨웁니다. 감정과 이성의 균형을 이루는 법을 배웁니다." },
                        { text: "달의 그림자 부분을 관찰한다", result: "보이지 않는 것에서 통찰을 얻습니다. 당신은 표면 아래의 진실을 볼 수 있는 능력이 있습니다." },
                        { text: "달의 주기를 기록한다", result: "변화와 순환의 법칙을 이해합니다. 당신은 시간의 흐름을 통찰하는 지혜를 얻었습니다." }
                    ],
                    19: [
                        { text: "태양빛을 온전히 받아들인다", result: "성취와 자신감이 충만해집니다. 당신은 자신의 빛으로 주변을 밝힐 수 있는 힘이 있습니다." },
                        { text: "태양 아래서 성장하는 식물을 관찰한다", result: "자연스러운 성장의 법칙을 이해합니다. 당신은 자신의 방식대로 번영할 수 있는 지혜를 얻었습니다." },
                        { text: "태양의 빛으로 그림자를 분석한다", result: "명암의 대비를 이해합니다. 당신은 밝음과 어둠의 균형을 이해하는 통찰력을 가졌습니다." }
                    ],
                    20: [
                        { text: "심판의 나팔 소리에 귀 기울인다", result: "메시지를 온전히 받아들입니다. 당신은 진실을 직시할 수 있는 용기가 있습니다." },
                        { text: "자신의 과거를 돌아본다", result: "성찰을 통해 교훈을 얻습니다. 당신은 과거의 경험을 미래의 지혜로 전환할 수 있습니다." },
                        { text: "부활의 의식을 준비한다", result: "새로운 시작을 위한 준비를 합니다. 당신은 끊임없이 자신을 갱신할 수 있는 회복력이 있습니다." }
                    ]
                }
            },
            {
                title: "제5장: 운명의 완성",
                description: "여정의 마지막 단계입니다. 당신의 운명을 완성할 카드를 선택하세요.",
                cards: [5, 10, 11, 21],
                stories: {
                    5: "전통과 지혜의 수호자가 당신을 맞이합니다. 이제 당신은 배움을 나눌 준비가 되었습니다. 정신적 가이드로서의 여정이 시작됩니다.",
                    10: "운명의 수레바퀴가 돌아갑니다. 때로는 위로, 때로는 아래로. 삶의 순환을 받아들이고 그 흐름에 몸을 맡기는 것이 지혜입니다.",
                    11: "균형 잡힌 저울을 든 정의의 여신이 나타납니다. 당신의 모든 행동에는 결과가 따릅니다. 진실과 공정함이 당신의 길이 됩니다.",
                    21: "마침내 당신은 세계의 중심에 섭니다. 모든 요소가 조화롭게 어우러지는 완성의 순간입니다. 하나의 여정이 끝나고 새로운 순환이 시작됩니다."
                },
                actions: {
                    5: [
                        { text: "전통적인 가르침을 받아들인다", result: "지혜의 전승자가 됩니다. 당신은 과거와 미래를 잇는 다리 역할을 할 것입니다." },
                        { text: "새로운 교리를 창조한다", result: "혁신적인 사상가가 됩니다. 당신은 전통의 기반 위에 새로운 지혜를 쌓을 것입니다." },
                        { text: "가르침을 다른 이들과 나눈다", result: "영적 스승이 됩니다. 당신은 자신의 지혜로 많은 이들의 삶을 변화시킬 것입니다." }
                    ],
                    10: [
                        { text: "수레바퀴의 중심에 서서 관찰한다", result: "균형과 중심을 찾습니다. 당신은 변화 속에서도 흔들리지 않는 중심을 유지할 것입니다." },
                        { text: "수레바퀴를 적극적으로 돌려본다", result: "변화의 촉매자가 됩니다. 당신은 운명을 주도적으로 이끌어가는 힘을 가졌습니다." },
                        { text: "수레바퀴의 패턴을 연구한다", result: "시간의 통찰자가 됩니다. 당신은 변화의 패턴을 예측하고 활용하는 지혜를 얻었습니다." }
                    ],
                    11: [
                        { text: "저울의 균형을 맞춘다", result: "정의의 수호자가 됩니다. 당신은 공정함과 균형을 중시하는 심판자가 될 것입니다." },
                        { text: "자신의 행동을 돌아본다", result: "진실한 성찰자가 됩니다. 당신은 스스로에게 정직하며 성장을 위해 노력할 것입니다." },
                        { text: "정의의 칼을 든다", result: "진실의 전사가 됩니다. 당신은 불의에 맞서 싸우는 용기를 가졌습니다." }
                    ],
                    21: [
                        { text: "춤을 추며 완성을 축하한다", result: "기쁨의 표현자가 됩니다. 당신은 삶의 모든 순간을 축복으로 받아들이는 지혜를 얻었습니다." },
                        { text: "세계를 둘러싼 원을 완성한다", result: "완성의 창조자가 됩니다. 당신은 분리된 것들을 하나로 모으는 통합의 능력을 가졌습니다." },
                        { text: "새로운 여정을 준비한다", result: "영원한 여행자가 됩니다. 당신에게 끝은 또 다른 시작의 문일 뿐입니다." }
                    ]
                }
            }
        ];
        
        // 엔딩 정의 (선택한 카드와 행동 조합에 따라 다양한 엔딩 구성)
        const endings = {
            // 몇 가지 예시 엔딩 (실제로는 더 많은 조합 필요)
            "0,7,13,19,21": "「빛의 혁명가」\n\n무모해 보이는 시작이었지만, 당신의 강한 의지는 모든 장애물을 뚫고 변화를 이끌어냈습니다. 죽음의 카드가 가져온 변화는 태양의 빛으로 이어졌고, 결국 당신은 세계의 중심에 서게 되었습니다. 당신은 새로운 시대를 여는 혁명가입니다. 두려움 없이 앞으로 나아가며 세상에 긍정적인 변화를 가져올 것입니다.",
            "1,6,15,17,11": "「균형의 마법사」\n\n창조의 힘으로 시작한 당신의 여정은 선택의 기로에서 사랑을 택했지만, 내면의 어둠과도 맞닥뜨렸습니다. 하지만 별의 희망을 통해 정의로운 균형을 찾아냈습니다. 당신은 빛과 어둠, 사랑과 이성 사이의 균형을 이루는 마법사입니다. 세상에 조화를 가져오는 중재자가 될 것입니다.",
            "2,9,12,18,10": "「신비의 현자」\n\n직관으로 시작된 당신의 여정은 고독한 성찰과 관점의 전환을 거쳐 달의 신비로운 세계로 이어졌습니다. 결국 운명의 수레바퀴와 마주하며 순환의 지혜를 얻었습니다. 당신은 현실 너머의 진실을 볼 수 있는 현자입니다. 직관과 지혜로 다른 이들을 깨우치는 안내자가 될 것입니다.",
            "3,8,16,20,5": "「지혜의 통치자」\n\n풍요로움으로 시작한 여정은 진정한 힘의 의미를 배웠고, 무너진 탑을 통해 허상을 버렸습니다. 심판의 순간을 거쳐 지혜의 전수자가 되었습니다. 당신은 힘과 지혜를 겸비한 통치자입니다. 파괴 후의 재건을 이끌며, 배움과 전통의 가치를 중요시하는 리더가 될 것입니다."
        };
        
        // 기본 게임 상태
        let gameState = {
            currentStage: 0,
            selectedCards: [],
            selectedActions: [],
            storyPath: [],
            actionPath: []
        };
        
        // DOM 요소
        const introSection = document.getElementById('intro');
        const gameStageSection = document.getElementById('game-stage');
        const endingSection = document.getElementById('ending');
        const stageTitle = document.getElementById('stage-title');
        const stageDescription = document.getElementById('stage-description');
        const cardsContainer = document.getElementById('cards-container');
        const storyText = document.getElementById('story-text');
        const actionChoices = document.getElementById('action-choices');
        const actionResult = document.getElementById('action-result');
        const nextButton = document.getElementById('next-button');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const endingText = document.getElementById('ending-text');
        
        // 게임 시작
        startButton.addEventListener('click', startGame);
        nextButton.addEventListener('click', goToNextStage);
        restartButton.addEventListener('click', restartGame);
        
        function startGame() {
            gameState = {
                currentStage: 0,
                selectedCards: [],
                selectedActions: [],
                storyPath: [],
                actionPath: []
            };
            
            introSection.classList.add('hidden');
            gameStageSection.classList.remove('hidden');
            endingSection.classList.add('hidden');
            
            loadStage(gameState.currentStage);
        }
        
        function loadStage(stageIndex) {
            const stage = stages[stageIndex];
            
            stageTitle.textContent = stage.title;
            stageDescription.textContent = stage.description;
            storyText.classList.add('hidden');
            actionChoices.classList.add('hidden');
            actionResult.classList.add('hidden');
            nextButton.disabled = true;
            
            // 카드 생성
            cardsContainer.innerHTML = '';
            stage.cards.forEach(cardId => {
                const card = tarotCards[cardId];
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.cardId = card.id;
                
                cardElement.innerHTML = `
                    <div class="card-front">
                        <div class="card-image">${card.symbol}</div>
                        <div class="card-name">${card.name}</div>
                    </div>
                `;
                
                cardElement.addEventListener('click', () => selectCard(cardElement, card.id));
                cardsContainer.appendChild(cardElement);
            });
        }
        
        function selectCard(cardElement, cardId) {
            // 이미 선택된 카드가 있으면 선택 해제
            const selectedCard = cardsContainer.querySelector('.card.selected');
            if (selectedCard) {
                selectedCard.classList.remove('selected');
            }
            
            // 새 카드 선택
            cardElement.classList.add('selected');
            
            // 스토리 표시
            const stage = stages[gameState.currentStage];
            storyText.textContent = stage.stories[cardId];
            storyText.classList.remove('hidden');
            
            // 행동 선택지 표시 (새로 추가된 부분)
            showActionChoices(cardId);
            
            // 다음 버튼 비활성화 (행동 선택 전까지)
            nextButton.disabled = true;
            
            // 게임 상태 업데이트
            gameState.selectedCards[gameState.currentStage] = cardId;
            gameState.storyPath[gameState.currentStage] = stage.stories[cardId];
        }
        
        // 행동 선택지 표시 함수 (새로 추가)
        function showActionChoices(cardId) {
            const stage = stages[gameState.currentStage];
            const actions = stage.actions[cardId];
            
            actionChoices.innerHTML = '';
            actionChoices.classList.remove('hidden');
            actionResult.classList.add('hidden');
            
            actions.forEach((action, index) => {
                const actionElement = document.createElement('div');
                actionElement.className = 'action-choice';
                actionElement.textContent = action.text;
                
                actionElement.addEventListener('click', () => selectAction(actionElement, cardId, index));
                actionChoices.appendChild(actionElement);
            });
        }
        
        // 행동 선택 함수 (새로 추가)
        function selectAction(actionElement, cardId, actionIndex) {
            // 이미 선택된 행동이 있으면 선택 해제
            const selectedAction = actionChoices.querySelector('.action-choice.selected');
            if (selectedAction) {
                selectedAction.classList.remove('selected');
            }
            
            // 새 행동 선택
            actionElement.classList.add('selected');
            
            // 행동 결과 표시
            const stage = stages[gameState.currentStage];
            const actionResult = document.getElementById('action-result');
            actionResult.textContent = stage.actions[cardId][actionIndex].result;
            actionResult.classList.remove('hidden');
            
            // 다음 버튼 활성화
            nextButton.disabled = false;
            
            // 게임 상태 업데이트
            gameState.selectedActions[gameState.currentStage] = actionIndex;
            gameState.actionPath[gameState.currentStage] = stage.actions[cardId][actionIndex].result;
        }
        
        function goToNextStage() {
            gameState.currentStage++;
            
            if (gameState.currentStage < stages.length) {
                loadStage(gameState.currentStage);
            } else {
                showEnding();
            }
        }
        
        function showEnding() {
            gameStageSection.classList.add('hidden');
            endingSection.classList.remove('hidden');
            
            // 선택한 카드 조합으로 엔딩 결정
            const cardCombo = gameState.selectedCards.join(',');
            let endingResult = '';
            
            // 정의된 엔딩이 있는지 확인
            if (endings[cardCombo]) {
                endingResult = endings[cardCombo];
            } else {
                // 정의되지 않은 조합인 경우 기본 엔딩 생성
                // 마지막 카드에 따라 다른 엔딩
                const lastCard = gameState.selectedCards[gameState.selectedCards.length - 1];
                
                if (lastCard === 5) {
                    endingResult = "「지혜의 탐구자」\n\n당신의 여정은 지식과 전통의 가치를 깨닫게 했습니다. 배움을 추구하며 그 지혜를 다른 이들과 나누는 것이 당신의 운명입니다.";
                } else if (lastCard === 10) {
                    endingResult = "「운명의 춤꾼」\n\n인생의 순환을 받아들이는 법을 배웠습니다. 당신은 변화에 유연하게 적응하며 운명의 흐름에 몸을 맡기는 지혜를 가졌습니다.";
                } else if (lastCard === 11) {
                    endingResult = "「정의의 수호자」\n\n진실과 균형의 중요성을 깨달았습니다. 당신은 공정함을 추구하며, 세상에 정의를 가져오는 역할을 할 것입니다.";
                } else if (lastCard === 21) {
                    endingResult = "「완성의 여행자」\n\n모든 것이 하나로 연결되어 있음을 이해하게 되었습니다. 당신은 전체성을 추구하며, 삶의 모든 측면을 조화롭게 통합하는 여정을 계속할 것입니다.";
                }
            }
            
            // 선택한 행동에 따른 세부 엔딩 추가
            endingResult += "\n\n당신이 선택한 행동들은 당신의 성격을 형성했습니다. ";
            
            // 마지막 행동 선택에 따른 추가 문구
            const lastStage = stages.length - 1;
            const lastAction = gameState.selectedActions[lastStage];
            const lastCardId = gameState.selectedCards[lastStage];
            
            if (lastCardId === 5) {
                if (lastAction === 0) {
                    endingResult += "당신은 전통의 지혜를 소중히 여기며, 그 가치를 다음 세대에 전하는 안내자가 될 것입니다.";
                } else if (lastAction === 1) {
                    endingResult += "당신은 기존의 지식을 바탕으로 새로운 사상을 창조하는 혁신가의 길을 걸을 것입니다.";
                } else {
                    endingResult += "당신은 자신의 경험과 지혜를 나누는 스승으로서 많은 이들에게 영감을 줄 것입니다.";
                }
            } else if (lastCardId === 10) {
                if (lastAction === 0) {
                    endingResult += "당신은 어떤 상황에서도 중심을 잃지 않는 균형 잡힌 삶을 살아갈 것입니다.";
                } else if (lastAction === 1) {
                    endingResult += "당신은 자신의 운명을 적극적으로 개척하며 변화를 주도하는 선구자가 될 것입니다.";
                } else {
                    endingResult += "당신은 시간의 패턴을 읽고 미래를 예측하는 지혜로운 조언자가 될 것입니다.";
                }
            } else if (lastCardId === 11) {
                if (lastAction === 0) {
                    endingResult += "당신은 공정함과 균형을 통해 갈등을 해결하는 중재자로서의 역할을 맡게 될 것입니다.";
                } else if (lastAction === 1) {
                    endingResult += "당신은 자기성찰을 통해 끊임없이 성장하며, 정직함으로 타인의 신뢰를 얻을 것입니다.";
                } else {
                    endingResult += "당신은 불의에 맞서 싸우며 약자를 보호하는 정의의 전사가 될 것입니다.";
                }
            } else if (lastCardId === 21) {
                if (lastAction === 0) {
                    endingResult += "당신은 삶의 모든 순간을 축하하며, 주변에 기쁨을 전하는 영감의 원천이 될 것입니다.";
                } else if (lastAction === 1) {
                    endingResult += "당신은 분리된 것들을 하나로 연결하는 통합의 능력으로 커뮤니티를 만들어갈 것입니다.";
                } else {
                    endingResult += "당신은 끊임없이 새로운 모험을 찾아 나서는 영원한 탐험가로서의 삶을 살게 될 것입니다.";
                }
            }
            
            endingText.innerText = endingResult;
        }
        
        function restartGame() {
            endingSection.classList.add('hidden');
            introSection.classList.remove('hidden');
        }
    </script>
</body>
</html>